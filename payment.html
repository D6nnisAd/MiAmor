<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Payment | MiAmor</title>

    <!-- FAVICON LINKS -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="shortcut icon" href="assets/favicon.ico">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #02040a;
            --background-dark: #04091A;
            --card-background: rgba(10, 25, 47, 0.75);
            --border-color: rgba(0, 242, 254, 0.2);
            --neon-cyan: #00f2fe;
            --neon-blue: #2c72ff;
            --neon-pink: #ff4081;
            --text-light: #f0f4f8;
            --text-muted: #a9b7d1;
            --success-color: #28a745;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-light);
            background-image: radial-gradient(circle at top left, rgba(44, 114, 255, 0.1), transparent 40%),
                              radial-gradient(circle at bottom right, rgba(0, 242, 254, 0.1), transparent 40%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .payment-container { width: 100%; max-width: 480px; }

        .payment-card {
            background: var(--card-background);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(12px);
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }
        
        .logo { max-width: 120px; margin-bottom: 0.5rem; transition: transform 0.3s ease; }
        .logo:hover { transform: scale(1.05); }
        .gateway-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 1.5rem;
        }

        h2 { font-size: 1.8rem; margin-bottom: 0.5rem; font-weight: 700; background: linear-gradient(90deg, var(--neon-cyan), var(--neon-blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        .header-note { color: var(--text-muted); margin-bottom: 1.5rem; font-size: 0.95rem; }

        /* --- UPDATED: OPay Warning Note --- */
        @keyframes pulse-warning {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 64, 129, 0.2); }
            50% { box-shadow: 0 0 25px rgba(255, 64, 129, 0.5); }
        }
        .warning-note {
            background-color: rgba(255, 64, 129, 0.1);
            border: 1px solid rgba(255, 64, 129, 0.4);
            border-radius: 8px;
            padding: 1rem;
            margin: -0.5rem 0 1.5rem 0;
            color: #f8d7da;
            font-size: 0.95rem;
            text-align: left;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            line-height: 1.6;
            animation: pulse-warning 3s infinite ease-in-out; /* NEW: Added animation */
        }
        .warning-note svg {
            flex-shrink: 0;
            width: 22px;
            height: 22px;
            margin-top: 2px;
            color: var(--neon-pink);
        }
        .warning-note b {
            text-transform: uppercase;
            color: white;
        }

        .summary-box, .payment-details-box { background: var(--background-dark); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; text-align: left; margin-bottom: 1.5rem; }

        .summary-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-size: 0.95rem; }
        .summary-row:last-child { margin-bottom: 0; }
        .summary-label { color: var(--text-muted); }
        .summary-value { font-weight: 600; color: var(--text-light); word-break: break-all; }
        #package-price { color: var(--neon-cyan); font-size: 1.1rem; }

        .payment-details-box h3 { text-align: center; margin-bottom: 1.5rem; font-weight: 500; color: var(--text-muted); }
        .detail-item { margin-bottom: 1.25rem; }
        .detail-item label { display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        
        .detail-value { display: flex; align-items: center; justify-content: space-between; background-color: var(--primary-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 4px 4px 4px 15px; }
        .detail-value span { font-weight: 600; font-size: 1rem; }
        .copy-btn { padding: 8px 15px; border: none; background-color: var(--neon-blue); color: var(--text-light); border-radius: 5px; cursor: pointer; font-weight: 500; transition: all 0.2s ease; }
        .copy-btn:hover { background-color: var(--neon-cyan); color: var(--background-dark); }
        
        .detail-input { width: 100%; background-color: var(--primary-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px 15px; font-weight: 600; font-size: 1rem; color: var(--text-light); font-family: 'Poppins', sans-serif; }

        .timer-text { text-align: center; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem; }
        #countdown-timer { font-weight: 600; font-size: 1rem; color: var(--neon-cyan); margin-left: 5px; }
        
        /* NEW: Post-payment instruction */
        .post-payment-note {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 10px; width: 100%; padding: 15px 40px; border-radius: 50px; font-weight: 600; text-decoration: none; transition: all 0.3s ease; border: none; cursor: pointer; font-size: 1.1rem; }
        .btn-primary { background: linear-gradient(90deg, var(--neon-blue), var(--neon-cyan)); color: var(--text-light); }
        .btn:disabled { opacity: 0.7; cursor: not-allowed; }
        
        .loader { width: 18px; height: 18px; border: 2px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .support-contact {
            margin-top: 2rem;
            text-align: center;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
        }
        .support-contact p { font-size: 0.95rem; color: var(--text-muted); line-height: 1.7; }
        .support-contact a { color: var(--neon-cyan); font-weight: 600; text-decoration: underline; text-decoration-style: dotted; text-underline-offset: 4px; transition: all 0.3s ease; }
        .support-contact a:hover { color: var(--text-light); text-decoration-style: solid; text-shadow: 0 0 8px var(--neon-cyan); }

        @media (max-width: 600px) {
            body { padding: 1rem 0.5rem; align-items: flex-start; min-height: 100%; }
            .payment-container { margin: 1rem 0; }
            .payment-card { padding: 1.25rem 1rem; border-radius: 15px; }
            .logo { max-width: 100px; }
            .gateway-label { font-size: 0.8rem; margin-bottom: 1rem; }
            h2 { font-size: 1.5rem; }
            .header-note { margin-bottom: 1rem; font-size: 0.9rem; }
            .warning-note { font-size: 0.9rem; padding: 0.8rem; }
            .summary-box, .payment-details-box, .timer-text { margin-bottom: 1rem; }
            .summary-box, .payment-details-box { padding: 1rem; }
            .summary-row { font-size: 0.9rem; margin-bottom: 0.75rem; }
            #package-price { font-size: 1rem; }
            .detail-item { margin-bottom: 1rem; }
            .detail-input, .detail-value span { font-size: 0.9rem; }
            .copy-btn { padding: 6px 12px; font-size: 0.85rem; }
            .btn { font-size: 1rem; padding: 12px 20px; }
            .support-contact p { font-size: 0.9rem; }
        }
    </style>
</head>
<body>

    <div class="payment-container">
        <div class="payment-card" id="payment-gateway">
            <a href="index.html"><img src="assets/logo.png" alt="MiAmor Logo" class="logo"></a>
            <p class="gateway-label">Payment Gateway</p>
            
            <h2>Founder's Slot Booking</h2>
            <p class="header-note">Complete the one-time booking fee to secure your place on the MiAmor waitlist</p>
            
            <!-- UPDATED: OPay Warning Note -->
            <div class="warning-note">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                <span><b>Note: DO NOT PAY WITH OPAY (Paycom).</b> It is not accepted on MiAmor. Please use any other bank or POS to pay.</span>
            </div>

            <div class="summary-box">
                <div class="summary-row">
                    <span class="summary-label">Package:</span>
                    <span class="summary-value" id="package-name">--</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Amount to Pay:</span>
                    <span class="summary-value" id="package-price">--</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Sender Email:</span>
                    <span class="summary-value" id="user-email">--</span>
                </div>
            </div>

            <div class="payment-details-box">
                <h3>Transfer to the account below</h3>
                <div class="detail-item">
                    <label>Account Number</label>
                    <div class="detail-value">
                        <span id="account-number">...</span>
                        <button class="copy-btn" data-copy-target="account-number">Copy</button>
                    </div>
                </div>
                <div class="detail-item">
                    <label>Bank</label>
                    <input type="text" id="bank-name" class="detail-input" value="..." readonly>
                </div>
                <div class="detail-item">
                    <label>Account Name</label>
                    <input type="text" id="account-name" class="detail-input" value="..." readonly>
                </div>
            </div>
            
            <p class="timer-text">Account will expire in <span id="countdown-timer">30:00</span></p>

            <form id="payment-confirmation-form">
                <!-- NEW: Post-payment instruction -->
                <p class="post-payment-note">After making payment, please contact support with your payment receipt.</p>
                <button type="submit" class="btn btn-primary">I have made payment</button>
            </form>
        </div>
        
        <div class="support-contact">
            <p>
                If you need more explanation on MiAmor, or you have any issue with making a payment, 
                <a href="https://wa.me/2349133613780?text=Hello+I+want+to+Pay+for+MiAmor+Coupon+Code+to+complete+my+registration" target="_blank" rel="noopener noreferrer">
                    click here to contact our Support Team.
                </a>
            </p>
        </div>

    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const packageData = {
        'plus': { name: 'MiAmor Plus', price: '₦10,000' },
        'ultra': { name: 'MiAmor Ultra', price: '₦14,000' }
    };

    const gateway = document.getElementById('payment-gateway');
    const urlParams = new URLSearchParams(window.location.search);
    const selectedPackageKey = urlParams.get('package');
    const userEmail = urlParams.get('email');
    const selectedPackageData = packageData[selectedPackageKey];

    if (selectedPackageData && userEmail) {
        document.getElementById('package-name').textContent = selectedPackageData.name;
        document.getElementById('package-price').textContent = selectedPackageData.price;
        document.getElementById('user-email').textContent = userEmail;
    } else {
        gateway.innerHTML = `<h2>Invalid Session</h2><p>Please <a href="register.html" style="color: var(--neon-cyan);">return to the registration page</a> and start over.</p>`;
        return;
    }

    const timerEl = document.getElementById('countdown-timer');
    let timeInSeconds = 30 * 60;
    const countdownInterval = setInterval(() => {
        timeInSeconds--;
        const minutes = Math.floor(timeInSeconds / 60).toString().padStart(2, '0');
        const seconds = (timeInSeconds % 60).toString().padStart(2, '0');
        timerEl.textContent = `${minutes}:${seconds}`;
        if (timeInSeconds <= 0) {
            clearInterval(countdownInterval);
            document.querySelector('.timer-text').innerHTML = "<p style='color: #ff4d4d; font-size: 1rem;'>Payment window has expired. Please restart the registration.</p>";
            document.querySelector('button[type="submit"]').disabled = true;
        }
    }, 1000);

    document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', (e) => { e.preventDefault(); const targetId = button.dataset.copyTarget; const textToCopy = document.getElementById(targetId).textContent; navigator.clipboard.writeText(textToCopy).then(() => { button.textContent = 'Copied!'; setTimeout(() => { button.textContent = 'Copy'; }, 2000); }); });
    });

});
</script>


<!-- =================== FIREBASE SCRIPT BLOCK ======================= -->

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
    // Your Firebase configuration object
 const firebaseConfig = {
    apiKey: "AIzaSyDAHKP-tu3QVDC6Ckr0_rGOFKWfQIeoNco",
    authDomain: "miamor-david.firebaseapp.com",
    databaseURL: "https://miamor-david-default-rtdb.firebaseio.com",
    projectId: "miamor-david",
    storageBucket: "miamor-david.firebasestorage.app",
    messagingSenderId: "494245301444",
    appId: "1:494245301444:web:c9af53c2f8cd96e62ccd91"
  };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const settingsRef = database.ref('settings');

    // Fetch and display the settings on page load
    settingsRef.get().then((snapshot) => {
        if (snapshot.exists()) {
            const data = snapshot.val();
            
            document.getElementById('account-number').textContent = data.account_number;
            document.getElementById('bank-name').value = data.bank_name;
            document.getElementById('account-name').value = data.account_name;

            const confirmationForm = document.getElementById('payment-confirmation-form');
            if (confirmationForm) {
                confirmationForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const submitButton = confirmationForm.querySelector('button[type="submit"]');
                    submitButton.disabled = true;
                    submitButton.innerHTML = `<span class="loader"></span> Confirming...`;

                    setTimeout(() => {
                        const phoneNumber = data.whatsapp_number;
                        const message = 'Hello, I have made payment on MiAmor Payment gateway, How can I start!';
                        const encodedMessage = encodeURIComponent(message);
                        const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;
                        window.location.href = whatsappUrl;
                    }, 1500);
                });
            }

        } else {
            console.error("Firebase Error: Could not find settings data.");
            document.getElementById('account-number').textContent = 'Error';
            document.getElementById('bank-name').value = 'Error loading data';
            document.getElementById('account-name').value = 'Please contact support';
        }
    }).catch((error) => {
        console.error("Firebase read failed: ", error);
    });
</script>

</body>
</html>
